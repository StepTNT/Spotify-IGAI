<!DOCTYPE HTML>
	<head>
		<title>Spotify-IGAI</title>
		<link rel="stylesheet" type="text/css" href="css/index.css">
		<script src="common-libs/jquery-2.1.1.min.js"></script>
		<script src="common-libs/d3.v3.min.js"></script>			
		<script>
			var isMosaic = false;
			var toMosaic = function(){
				if (isMosaic) return; // Siamo già nella modalità mosaico, non devo fare niente
					$("#grafico1").animate({ height: $("#grafico1").height()/2-70, width: $("#grafico1").width()/2-25, opacity:1}, 500);
					$("#grafico2").animate({ height: $("#grafico2").height()/2-70, width: $("#grafico2").width()/2-25, left:"47%", opacity:1}, 500);				
					$("#grafico3").animate({ height: $("#grafico3").height()/2-70, width: $("#grafico3").width()/2-25, top:"58%", opacity:1}, 500);				
					$("#grafico4").animate({ height: $("#grafico4").height()/2-70, width: $("#grafico3").width()/2-25, top:"58%", left: "47%", opacity:1}, 500);				
					isMosaic = true;
					// Segnalo ai grafici che ho cambiato la modalità di visualizzazione
					mapChart.toMosaic();
					lineChart.toMosaic();
					forceChart.toMosaic();
			};
			var toFull = function(grafico){
				if(isMosaic){ // Sto parendo dal mosaico, quindi devo ripristinare i valori precedenti						
					$(".graficoContent").animate({ height: "50%", left: 5, top: "21%", width: "90%", opacity:0, "z-index":0}, 500);
					$(grafico).animate({ height: "50%", left: 5, top: "21%", width: "90%", opacity:1, "z-index":1}, 500);
					isMosaic = false;
				} else {
					$(".graficoContent").animate({opacity:0, "z-index":0});
					$(grafico).delay(250).animate({opacity:1, "z-index":1});
				}	
				// Segnalo ai grafici che ho cambiato la modalità di visualizzazione
				mapChart.toFull();
				lineChart.toFull();
				forceChart.toFull();
			};
			jQuery(document).ready(function($) {			
				$(".scroll").click(function(event) {
					event.preventDefault();						
					var grafico = "#" + event.currentTarget.id.replace("-btn", "");
					toFull(grafico);				
				});
				$(".mosaic").click(function(event) {
					event.preventDefault();								
					toMosaic();					
				});	
				toMosaic(); // La visualizzazione di default è quella con il mosaico dei grafici				
			});
		</script>
	</head>
	<body>
		<div id="wrap">
			<!-- TODO: sviluppare il widget per l'header invece di cambiare l'html a mano ogni volta -->
			<div id="header">HEADER</div>
			<div id="content">
				<div id="grafico1" class="graficoContent" style="opacity:1; border: 1px solid red;">
					<link href="charts/map/map.css" rel="stylesheet" type="text/css">					
					<script src="charts/map/libs/topojson.v1.min.js"></script>
					<script src="charts/map/libs/colorbrewer.js"></script>
					<script src="charts/map/map.js"></script>
					<div id="mapChart" style="margin :5px; height: 520px;"></div>
					<script type="text/javascript">
						// Creo l'oggetto grafico
						var mapChart = new Map();
						// Registro i listener per gli eventi
						document.addEventListener('map.stateChanged', function(e){ 
								console.log("map.stateChanged - " + e.detail.state); 
							}, false);
						document.addEventListener('map.trackChanged', function(e){ 
								$("#header").html(e.detail.track.track_name);
								console.log("map.trackChanged - " + e.detail.track.track_name); 
							}, false);
						document.addEventListener('map.countryChanged', function(e){ 
								$("#header").html(e.detail.country.id);
								console.log("map.countryChanged - " + e.detail.country.id); 
							}, false);
						// Disegno la mappa
						mapChart.draw();		
					</script>
				</div>
				<div id="grafico2" class="graficoContent" style="border: 1px solid blue; opacity:0">
					<link href="charts/line/line.css" rel="stylesheet" type="text/css">
					<script src="charts/line/libs/nv.d3.js"></script>
					<script src="charts/line/libs/tooltip.js"></script>
					<script src="charts/line/libs/utils.js"></script>
					<script src="charts/line/libs/models/legend.js"></script>
					<script src="charts/line/libs/models/axis.js"></script>
					<script src="charts/line/libs/models/lineWithFocusChart.js"></script>					
					<script src="charts/line/libs/models/line.js"></script>
					<script src="charts/line/libs/models/scatter.js"></script>					
					<script src="charts/line/line.js"></script>				
					<div id="lineChart" class='with-3d-shadow with-transitions'>
				    	<svg transform="translate(-10,0)scale(0.615,0.58)" height="NaN" width="NaN" viewBox="0 0 940 400" preserveAspectRatio="xMidYMid meet" style="">
				    </div>
				    <script type="text/javascript">
						// Creo l'oggetto grafico
						var lineChart = new Line();
						// Registro i listener per gli eventi
						document.addEventListener('line.stateChanged', function(e){ 
								console.log("line.stateChanged - " + e.detail.state); 
							}, false);
						document.addEventListener('line.trackChanged', function(e){ 
								$("#header").html(e.detail.track.track_name);
								console.log("line.trackChanged - " + e.detail.track.track_name); 
							}, false);
						document.addEventListener('line.countryChanged', function(e){ 
								$("#header").html(e.detail.country.id);
								console.log("line.countryChanged - " + e.detail.country.id); 
							}, false);
						// Disegno il grafo
						lineChart.draw();
					  </script>								  		 
				</div>
				<div id="grafico3" class="graficoContent" style="border: 1px solid green; opacity:0">
					<link rel="stylesheet" href="charts/force/force.css"/>
					<script src="charts/force/force.js"></script>
					<div id="forceChart"></div>
					<div id="sidepanel">
						<div id="title">
						</div>
						<div id="trackInfo" class="panel_off">
							<div id="cover" height="100"></div>
						</div>
					</div>
					<script type="text/javascript">
						// Creo l'oggetto grafico
						var forceChart = new Force();
						// Registro i listener per gli eventi
						document.addEventListener('force.stateChanged', function(e){ 
								console.log("force.stateChanged - " + e.detail.state); 
							}, false);
						document.addEventListener('force.trackChanged', function(e){ 
								$("#header").html(e.detail.track.track_name);
								console.log("force.trackChanged - " + e.detail.track.track_name); 
							}, false);
						document.addEventListener('force.countryChanged', function(e){ 
								$("#header").html(e.detail.country.id);
								console.log("force.countryChanged - " + e.detail.country.id); 
							}, false);
						// Disegno il grafo
						forceChart.draw();
					  </script>
				</div>
				<div id="grafico4" class="graficoContent" style="border: 1px solid yellow; opacity:0">GRAFICO 4</div>				
			</div>
		</div>
		<div id="footer">
			<a href="#grafico1" id="grafico1-btn" class="scroll">1</a>
			<a href="#grafico2" id="grafico2-btn" class="scroll">2</a>
			<a href="#grafico3" id="grafico3-btn" class="scroll">3</a>
			<a href="#grafico4" id="grafico4-btn" class="scroll">4</a>
			<a href="#mosaic" id="mosaic-btn" class="mosaic" style="float: right; margin: 5px 5px 0px 0px;">Mosaic</a>
		</div>
	</body>
</html>